<!DOCTYPE html>

<html>

<head>
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #map,
    #pano {
      float: left;
      height: 100%;
      width: 45%;
    }
  </style>
</head>

<body>
  <h3>My Google Maps Demo</h3>
  <div id="map"></div>
  <div id="pano"></div>
  <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?language=fra&amp;sensor=false"></script>
  <script type="text/javascript">
    var map;
    var Markers = {};
    var infowindow;

    var origin = new google.maps.LatLng(0, 0);

    function initialize() {
      var mapOptions = {
        zoom: 17,
        center: origin
      };
      map = new google.maps.Map(document.getElementById('map'), mapOptions);
      infowindow = new google.maps.InfoWindow();

      var sv = new google.maps.StreetViewService();
      panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'));
      var panLoc = {
        lat: 0,
        lng: 0
      };

      var nodes = data.map(function (object) {
        return [object["lat"], object["long"], object["accel"], object["generator"], object["date_time"]]
      });

      var latlng = []

      for (i = 0; i < nodes.length; i++) {
        var position = new google.maps.LatLng(nodes[i][0], nodes[i][1]);
        latlng[i] = position;
        var marker = new google.maps.Marker({
          position: position,
          map: map,
        });
        google.maps.event.addListener(marker, 'click', (function (marker, i) {
          return function () {
            infowindow.setContent('<h3><strong>' + nodes[i][4] + '</strong></h3>' +
              '<p>' + 'lat: ' + nodes[i][0] + ', long: ' + nodes[i][1] + '</p>' +
              '<p>' + 'accel: ' + nodes[i][2] + '</p>' +
              '<p>' + 'generator: ' + nodes[i][3] + '</p>'
            );
            infowindow.open(map, marker);

            sv.getPanorama({
              location: {
                lat: Number(nodes[i][0]),
                lng: Number(nodes[i][1])
              },
              radius: 50
            }, processSVData);
          }
        })(marker, i));
      }
      var latlngbounds = new google.maps.LatLngBounds();
      for (var i = 0; i < latlng.length; i++) {
        latlngbounds.extend(latlng[i]);
      }
      map.fitBounds(latlngbounds);
    }
    google.maps.event.addDomListener(window, 'load', initialize);

    function processSVData(data, status) {
      if (status === 'OK') {

        panorama.setPano(data.location.pano);
        panorama.setPov({
          heading: 270,
          pitch: 0
        });

        panorama.setVisible(true);
        
      } else {
        console.error('Street View data not found for this location.');
      }
    }
  </script>
  <form action="" method="post">
    {% csrf_token %} {{ form }}
    <input type="submit" value="Submit" />
  </form>
</body>
<script type="text/javascript">
  var data = [{
      "lat": "32.9480",
      "long": "-96.7299",
      "accel": "54322.000000",
      "generator": 1,
      "date_time": "2015-03-01T08:23:15+00:00"
    },
    {
      "lat": "32.9483",
      "long": "-96.7290",
      "accel": "41345.000000",
      "generator": 1,
      "date_time": "2012-03-01T08:12:15+00:00"
    },
    {
      "lat": "32.9485",
      "long": "-96.7295",
      "accel": "2425.000000",
      "generator": 1,
      "date_time": "2011-03-01T08:4:15+00:00"
    }
  ];
</script>

</html>